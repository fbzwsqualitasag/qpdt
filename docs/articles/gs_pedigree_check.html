<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checking Consistency of Animal Pedigrees • qpdt</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Checking Consistency of Animal Pedigrees">
<meta property="og:description" content="qpdt">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qpdt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gs_pedigree_check.html">Checking Consistency of Animal Pedigrees</a>
    </li>
    <li>
      <a href="../articles/pedigree_check_report.html">Report Pedigree Checks</a>
    </li>
    <li>
      <a href="../articles/pedigree_cycle_check.html">Check for Cycles in Pedigrees</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fbzwsqualitasag/qpdt/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="gs_pedigree_check_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Checking Consistency of Animal Pedigrees</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fbzwsqualitasag/qpdt/blob/master/vignettes/gs_pedigree_check.Rmd"><code>vignettes/gs_pedigree_check.Rmd</code></a></small>
      <div class="hidden name"><code>gs_pedigree_check.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">qpdt</span>)</pre></body></html></div>
<div id="disclaimer" class="section level1">
<h1 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h1>
<p>Pedigrees that are analysed by the software system PopReport must fullfill certain properties and must be formatted according to certain rules. The proporties and the fullfillment of the rules are checked by this package. The checks that are implemented in this package are described in this vignette.</p>
</div>
<div id="checks-and-diagnoses" class="section level1">
<h1 class="hasAnchor">
<a href="#checks-and-diagnoses" class="anchor"></a>Checks and Diagnoses</h1>
<p>The checks of the pedigrees are based on the following points</p>
<ul>
<li>number of records</li>
<li>number of unique IDs</li>
<li>number of animals with parents</li>
<li>empirical distribution of birthdates</li>
<li>empirical distribution of sexes</li>
<li>empirical distribution of postal codes</li>
</ul>
</div>
<div id="uniqueness-of-animal-ids" class="section level1">
<h1 class="hasAnchor">
<a href="#uniqueness-of-animal-ids" class="anchor"></a>Uniqueness of Animal IDs</h1>
<p>Animal IDs are the primary keys of an individual. Hence these IDs must be unique. This uniqueness is tested with the following statement using the function <code><a href="../reference/check_pedig_id.html">check_pedig_id()</a></code>. This function requires the path to an input pedigree as an argument. This package contains a number of test pedigrees which can be tested by the following statement.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># get path to test pedigrees</span>
(<span class="no">vec_ped_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata'</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'qpdt'</span>), <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample.csv"                             </span>
<span class="co">#&gt; [2] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample2.csv"                            </span>
<span class="co">#&gt; [3] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_GG_mit_20210113.csv_adaptfin2.csv" </span>
<span class="co">#&gt; [4] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_SN_ohne_20210115.csv_adaptfin2.csv"</span></pre></body></html></div>
<p>The first pedigree is the test-pedigree that can be obtained from the GenMon-Website. The difference between the first and the second test-pedigree is that the first has an animal with ‘F’ as a sire. In the second pedigree, this sire is removed. The first pedigree is checked by the following statement.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/check_pedig_id.html">check_pedig_id</a></span>(<span class="kw">ps_pedig_path</span> <span class="kw">=</span> <span class="no">vec_ped_path</span>[<span class="fl">1</span>],
               <span class="kw">ps_id_col</span> <span class="kw">=</span> <span class="st">'#animal'</span>)
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; $PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrRecord</span>
<span class="co">#&gt; [1] 1227</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrAnimals</span>
<span class="co">#&gt; [1] 1227</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblDuplicates</span>
<span class="co">#&gt; NULL</span></pre></body></html></div>
<p>The output of the test-pedigree indicates that all animal IDs are unique.</p>
<p>The checks of the remaining pedigrees are run by applying the function <code>check_pedig_id</code> to all the pedigrees.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># run checks</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">vec_ped_path</span>[<span class="fl">3</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">vec_ped_path</span>)], <span class="no">check_pedig_id</span>)
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>

<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [[1]]$PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_GG_mit_20210113.csv_adaptfin2.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrRecord</span>
<span class="co">#&gt; [1] 172076</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrAnimals</span>
<span class="co">#&gt; [1] 172063</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblDuplicates</span>
<span class="co">#&gt; # A tibble: 32 x 9</span>
<span class="co">#&gt;    `#IDTier`   IDVater IDMutter Birthdate  Geschlecht   PLZ introg inb_gen  cryo</span>
<span class="co">#&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1     99954 999532045   9.99e8 1996-01-26 F           3550      0 NA          0</span>
<span class="co">#&gt;  2     99954 999555626   1.00e9 1998-03-08 F           3274      0 NA          0</span>
<span class="co">#&gt;  3     99950 999434122   1.00e9 1981-04-04 F           3052      0 NA          0</span>
<span class="co">#&gt;  4     99950 999558998   1.00e9 2002-03-12 F           3537      0 NA          0</span>
<span class="co">#&gt;  5     99956 999555626   1.00e9 1998-03-08 F           3274      0 NA          0</span>
<span class="co">#&gt;  6     99956 999466991   1.00e9 2003-02-02 F           3152      0 NA          0</span>
<span class="co">#&gt;  7     99956 999560618   1.00e9 2004-02-14 F           3619      0 NA          0</span>
<span class="co">#&gt;  8     99957 999467818   1.00e9 2000-04-10 F           3537      0 NA          0</span>
<span class="co">#&gt;  9     99957 999466991   1.00e9 2003-02-04 M           3152      0 NA          0</span>
<span class="co">#&gt; 10     99958 999555626   1.00e9 1998-03-05 F           3252      0 NA          0</span>
<span class="co">#&gt; # … with 22 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [[2]]$PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_SN_ohne_20210115.csv_adaptfin2.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrRecord</span>
<span class="co">#&gt; [1] 95119</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrAnimals</span>
<span class="co">#&gt; [1] 95119</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblDuplicates</span>
<span class="co">#&gt; NULL</span></pre></body></html></div>
<p>The output of the second pedigree shows that all animal IDs are unique. The output of the first pedigree shows a list of duplicated IDs. They must be removed.</p>
</div>
<div id="parents" class="section level1">
<h1 class="hasAnchor">
<a href="#parents" class="anchor"></a>Parents</h1>
<p>Interesting quantities related to parents are</p>
<ul>
<li>number of animals with parents</li>
<li>are parents also animals</li>
<li>parent and offspring pairs with inconsistent birthdates</li>
</ul>
<p>The following function call checks the properties of parents for the first test pedigree /private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample2.csv.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/check_pedig_parent.html">check_pedig_parent</a></span>(<span class="kw">ps_pedig_path</span> <span class="kw">=</span> <span class="no">vec_ped_path</span>[<span class="fl">2</span>],
                   <span class="kw">ps_id_col</span>        <span class="kw">=</span> <span class="st">'#animal'</span>,
                   <span class="kw">ps_sire_col</span>      <span class="kw">=</span> <span class="st">'sire'</span>,
                   <span class="kw">ps_dam_col</span>       <span class="kw">=</span> <span class="st">'dam'</span>,
                   <span class="kw">ps_bd_col</span>        <span class="kw">=</span> <span class="st">'birth_date'</span>,
                   <span class="kw">ps_sex_col</span>       <span class="kw">=</span> <span class="st">'sex'</span>)
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; $PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample2.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrMissingSire</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrMissingDam</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrSireNotAnimal</span>
<span class="co">#&gt; [1] 137</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $NrDamNotAnimal</span>
<span class="co">#&gt; [1] 330</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblSireBdate</span>
<span class="co">#&gt; # A tibble: 0 x 4</span>
<span class="co">#&gt; # … with 4 variables: `#animal` &lt;dbl&gt;, sire &lt;dbl&gt;, `birth_date.#animal` &lt;date&gt;,</span>
<span class="co">#&gt; #   birth_date.sire &lt;date&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblDamBdate</span>
<span class="co">#&gt; # A tibble: 0 x 4</span>
<span class="co">#&gt; # … with 4 variables: `#animal` &lt;dbl&gt;, dam &lt;dbl&gt;, `birth_date.#animal` &lt;date&gt;,</span>
<span class="co">#&gt; #   birth_date.dam &lt;date&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblSireEqID</span>
<span class="co">#&gt; # A tibble: 0 x 9</span>
<span class="co">#&gt; # … with 9 variables: `#animal` &lt;dbl&gt;, sire &lt;dbl&gt;, dam &lt;dbl&gt;,</span>
<span class="co">#&gt; #   birth_date &lt;date&gt;, sex &lt;chr&gt;, plz &lt;dbl&gt;, introg &lt;dbl&gt;, inb_gen &lt;lgl&gt;,</span>
<span class="co">#&gt; #   cryo &lt;lgl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblDamEqID</span>
<span class="co">#&gt; # A tibble: 0 x 9</span>
<span class="co">#&gt; # … with 9 variables: `#animal` &lt;dbl&gt;, sire &lt;dbl&gt;, dam &lt;dbl&gt;,</span>
<span class="co">#&gt; #   birth_date &lt;date&gt;, sex &lt;chr&gt;, plz &lt;dbl&gt;, introg &lt;dbl&gt;, inb_gen &lt;lgl&gt;,</span>
<span class="co">#&gt; #   cryo &lt;lgl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblSireWrongSex</span>
<span class="co">#&gt; # A tibble: 0 x 2</span>
<span class="co">#&gt; # … with 2 variables: sire &lt;dbl&gt;, sex &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $TblDamWrongSex</span>
<span class="co">#&gt; # A tibble: 0 x 2</span>
<span class="co">#&gt; # … with 2 variables: dam &lt;dbl&gt;, sex &lt;chr&gt;</span></pre></body></html></div>
<p>The checks for the other test pedigrees are done with the following apply-statement. This is possible, because these pedigrees have the same column headers.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">vec_ped_path</span>[<span class="fl">3</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">vec_ped_path</span>)], <span class="no">check_pedig_parent</span>)
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>

<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [[1]]$PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_GG_mit_20210113.csv_adaptfin2.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrMissingSire</span>
<span class="co">#&gt; [1] 9288</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrMissingDam</span>
<span class="co">#&gt; [1] 5617</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrSireNotAnimal</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$NrDamNotAnimal</span>
<span class="co">#&gt; [1] 23</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblSireBdate</span>
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   `#IDTier`   IDVater `Birthdate.#IDTier` Birthdate.IDVater</span>
<span class="co">#&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;              &lt;date&gt;           </span>
<span class="co">#&gt; 1 999780574 999780544 1910-01-01          2007-03-01       </span>
<span class="co">#&gt; 2 999780582 999780544 1910-01-01          2007-03-01       </span>
<span class="co">#&gt; 3 999750225 999439795 1910-01-02          1991-12-14       </span>
<span class="co">#&gt; 4 999552253 999552298 1994-03-01          1995-03-01       </span>
<span class="co">#&gt; 5 999780535 999481777 1995-03-01          1997-11-15       </span>
<span class="co">#&gt; 6 999791525 999757076 2010-03-01          2010-12-23       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblDamBdate</span>
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   `#IDTier`  IDMutter `Birthdate.#IDTier` Birthdate.IDMutter</span>
<span class="co">#&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;              &lt;date&gt;            </span>
<span class="co">#&gt; 1 999780585 999774799 1910-01-01          2007-03-01        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblSireEqID</span>
<span class="co">#&gt; # A tibble: 0 x 9</span>
<span class="co">#&gt; # … with 9 variables: `#IDTier` &lt;dbl&gt;, IDVater &lt;dbl&gt;, IDMutter &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Birthdate &lt;date&gt;, Geschlecht &lt;chr&gt;, PLZ &lt;dbl&gt;, introg &lt;dbl&gt;, inb_gen &lt;lgl&gt;,</span>
<span class="co">#&gt; #   cryo &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblDamEqID</span>
<span class="co">#&gt; # A tibble: 1 x 9</span>
<span class="co">#&gt;    `#IDTier`  IDVater  IDMutter Birthdate  Geschlecht   PLZ introg inb_gen  cryo</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1004954789   1.00e9    1.00e9 NA         F             NA      0 NA          0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblSireWrongSex</span>
<span class="co">#&gt; # A tibble: 0 x 2</span>
<span class="co">#&gt; # … with 2 variables: IDVater &lt;dbl&gt;, Geschlecht &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[1]]$TblDamWrongSex</span>
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;     IDMutter Geschlecht</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt; 1 1004954570 M         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [[2]]$PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/PopReport_SN_ohne_20210115.csv_adaptfin2.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrMissingSire</span>
<span class="co">#&gt; [1] 1211</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrMissingDam</span>
<span class="co">#&gt; [1] 462</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrSireNotAnimal</span>
<span class="co">#&gt; [1] 4243</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$NrDamNotAnimal</span>
<span class="co">#&gt; [1] 6468</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblSireBdate</span>
<span class="co">#&gt; # A tibble: 9 x 4</span>
<span class="co">#&gt;    `#IDTier`    IDVater `Birthdate.#IDTier` Birthdate.IDVater</span>
<span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;date&gt;              &lt;date&gt;           </span>
<span class="co">#&gt; 1 1000810031 1000050624 2013-03-09          2013-05-02       </span>
<span class="co">#&gt; 2  999870937 1000161006 2013-03-20          2013-10-08       </span>
<span class="co">#&gt; 3 1000810027 1000050624 2013-03-25          2013-05-02       </span>
<span class="co">#&gt; 4 1000813707 1000050624 2013-03-26          2013-05-02       </span>
<span class="co">#&gt; 5 1000810038 1000050624 2013-03-26          2013-05-02       </span>
<span class="co">#&gt; 6 1000810020 1000050624 2013-04-15          2013-05-02       </span>
<span class="co">#&gt; 7 1000711443 1000050624 2013-04-15          2013-05-02       </span>
<span class="co">#&gt; 8 1000456126 1005609568 2013-11-26          2016-02-02       </span>
<span class="co">#&gt; 9 1004653188 1005845648 2015-03-07          2016-09-29       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblDamBdate</span>
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;    `#IDTier`   IDMutter `Birthdate.#IDTier` Birthdate.IDMutter</span>
<span class="co">#&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;date&gt;              &lt;date&gt;            </span>
<span class="co">#&gt; 1      99768      99765 1983-03-20          1985-02-26        </span>
<span class="co">#&gt; 2 1000878464 1004910666 2015-03-05          2015-10-12        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblSireEqID</span>
<span class="co">#&gt; # A tibble: 0 x 9</span>
<span class="co">#&gt; # … with 9 variables: `#IDTier` &lt;dbl&gt;, IDVater &lt;dbl&gt;, IDMutter &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Birthdate &lt;date&gt;, Geschlecht &lt;chr&gt;, PLZ &lt;dbl&gt;, introg &lt;dbl&gt;, inb_gen &lt;lgl&gt;,</span>
<span class="co">#&gt; #   cryo &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblDamEqID</span>
<span class="co">#&gt; # A tibble: 1 x 9</span>
<span class="co">#&gt;    `#IDTier`  IDVater  IDMutter Birthdate  Geschlecht   PLZ introg inb_gen  cryo</span>
<span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1004866450   9.99e8    1.00e9 2011-03-27 F           7411      0 NA          0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblSireWrongSex</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;      IDVater Geschlecht</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt; 1 1007737726 F         </span>
<span class="co">#&gt; 2 1006000916 F         </span>
<span class="co">#&gt; 3 1004668293 F         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]$TblDamWrongSex</span>
<span class="co">#&gt; # A tibble: 0 x 2</span>
<span class="co">#&gt; # … with 2 variables: IDMutter &lt;dbl&gt;, Geschlecht &lt;chr&gt;</span></pre></body></html></div>
</div>
<div id="datatypes" class="section level1">
<h1 class="hasAnchor">
<a href="#datatypes" class="anchor"></a>Datatypes</h1>
<p>The processing of the pedigrees by PopReport and further by GenMon, requires that the columns of the pedigree contain objects of a certain data-type. The requirement of the data-types is checked by the function <code><a href="../reference/check_pedigree_datatypes.html">check_pedigree_datatypes()</a></code>. The following statement shows a few tests and experiments.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">tbl_ped</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_prp_pedigree.html">read_prp_pedigree</a></span>(<span class="kw">ps_pedig_path</span> <span class="kw">=</span> <span class="no">vec_ped_path</span>[<span class="fl">1</span>], <span class="kw">ps_delim</span> <span class="kw">=</span> <span class="st">'|'</span>)
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span></pre></body></html></div>
<p>The data-types can be checked using the function <code><a href="https://rdrr.io/r/base/class.html">class()</a></code>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"#animal"</span>]])
<span class="co">#&gt; [1] "numeric"</span></pre></body></html></div>
<p>In the pedigree ‘tbl_ped’, the column ‘sire’ has an unexpected data-type which is shown by</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"sire"</span>]])
<span class="co">#&gt; [1] "character"</span></pre></body></html></div>
<p>The column birthdate can have a special data-type</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"birth_date"</span>]])
<span class="co">#&gt; [1] "Date"</span></pre></body></html></div>
<p>A similar functionality can be achieved by the function <code><a href="https://readr.tidyverse.org/reference/parse_guess.html">readr::guess_parser()</a></code>.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_guess.html">guess_parser</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"sire"</span>]], <span class="kw">guess_integer</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; [1] "character"</span></pre></body></html></div>
<p>For the column of dams</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_guess.html">guess_parser</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"dam"</span>]], <span class="kw">guess_integer</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; [1] "integer"</span></pre></body></html></div>
<p>In case of a column with floating point numbers, we get</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_guess.html">guess_parser</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="st">"introg"</span>]], <span class="kw">guess_integer</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; [1] "double"</span></pre></body></html></div>
<p>For each of the columns to be checked, we give the required data-type. This can be specified in a list</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">(<span class="no">l_req_dt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#animal"</span>, <span class="st">"sire"</span>, <span class="st">"dam"</span>, <span class="st">"birth_date"</span>, <span class="st">"sex"</span>, <span class="st">"plz"</span>, <span class="st">"introg"</span>),
                  <span class="kw">dtp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"integer"</span>, <span class="st">"integer"</span>, <span class="st">"integer"</span>, <span class="st">"date"</span>, <span class="st">"character"</span>, <span class="st">"integer"</span>, <span class="st">"double"</span>)))
<span class="co">#&gt; $col</span>
<span class="co">#&gt; [1] "#animal"    "sire"       "dam"        "birth_date" "sex"       </span>
<span class="co">#&gt; [6] "plz"        "introg"    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dtp</span>
<span class="co">#&gt; [1] "integer"   "integer"   "integer"   "date"      "character" "integer"  </span>
<span class="co">#&gt; [7] "double"</span></pre></body></html></div>
<p>The check can be performed in a simple loop</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">readr</span>)
<span class="no">tbl_par_problem</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="kw">for</span> (<span class="no">idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">l_req_dt</span>$<span class="no">col</span>)) {
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">" * Checking column: "</span>, <span class="no">l_req_dt</span>$<span class="no">col</span>[<span class="no">idx</span>], <span class="st">"\n"</span>)
  <span class="no">s_cur_parser</span> <span class="kw">&lt;-</span> <span class="kw pkg">readr</span><span class="kw ns">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_guess.html">guess_parser</a></span>(<span class="no">tbl_ped</span><span class="kw">[[</span> <span class="no">l_req_dt</span>$<span class="no">col</span>[<span class="no">idx</span>]]], <span class="kw">guess_integer</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  <span class="kw">if</span> (<span class="no">s_cur_parser</span> <span class="kw">!=</span> <span class="no">l_req_dt</span>$<span class="no">dtp</span>[<span class="no">idx</span>]){
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">" *** ERROR: column "</span>,  <span class="no">l_req_dt</span>$<span class="no">col</span>[<span class="no">idx</span>], <span class="st">" wrong datatype\n"</span>)
    <span class="no">parfun</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.fun.html">match.fun</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'parse_'</span>, <span class="no">l_req_dt</span>$<span class="no">dtp</span>[<span class="no">idx</span>], <span class="kw">sep</span> <span class="kw">=</span> <span class="st">''</span>))
    <span class="no">par_result</span> <span class="kw">&lt;-</span> <span class="fu">parfun</span>(<span class="no">tbl_ped</span><span class="kw">[[</span><span class="no">l_req_dt</span>$<span class="no">col</span>[<span class="no">idx</span>]]])
    <span class="no">tbl_par_problem</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/problems.html">problems</a></span>(<span class="no">par_result</span>)
  }
}
<span class="co">#&gt;  * Checking column:  #animal </span>
<span class="co">#&gt;  * Checking column:  sire </span>
<span class="co">#&gt;  *** ERROR: column  sire  wrong datatype</span>
<span class="co">#&gt; Warning: 1 parsing failure.</span>
<span class="co">#&gt; row col   expected actual</span>
<span class="co">#&gt; 477  -- an integer      F</span>
<span class="co">#&gt;  * Checking column:  dam </span>
<span class="co">#&gt;  * Checking column:  birth_date </span>
<span class="co">#&gt;  * Checking column:  sex </span>
<span class="co">#&gt;  * Checking column:  plz </span>
<span class="co">#&gt;  * Checking column:  introg</span>
<span class="no">tbl_par_problem</span>
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;     row   col expected   actual</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; </span>
<span class="co">#&gt; 1   477    NA an integer F</span></pre></body></html></div>
<p>The check is implemented in the function <code><a href="../reference/check_pedigree_datatypes.html">check_pedigree_datatypes()</a></code>. This function requires as an input a list with column names and required datatypes. Such a list can be obtained using the function <code><a href="../reference/get_pedigree_datatypes.html">get_pedigree_datatypes()</a></code>.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r">(<span class="no">l_ped_dt_result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pedigree_datatypes.html">get_pedigree_datatypes</a></span>(<span class="kw">ps_pedig_path</span> <span class="kw">=</span> <span class="no">vec_ped_path</span>[<span class="fl">1</span>]))
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; $PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $l_dtype</span>
<span class="co">#&gt; $l_dtype$col</span>
<span class="co">#&gt; [1] "#animal"    "sire"       "dam"        "birth_date" "sex"       </span>
<span class="co">#&gt; [6] "plz"        "introg"     "inb_gen"    "cryo"      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $l_dtype$dtp</span>
<span class="co">#&gt; [1] "integer"   "character" "integer"   "date"      "character" "integer"  </span>
<span class="co">#&gt; [7] "double"    "logical"   "logical"</span></pre></body></html></div>
<p>The list required as input for <code><a href="../reference/check_pedigree_datatypes.html">check_pedigree_datatypes()</a></code> is obtained as the component <code>l_dtype</code> of the result of <code><a href="../reference/get_pedigree_datatypes.html">get_pedigree_datatypes()</a></code> by</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">l_ped_dt_result</span>$<span class="no">l_dtype</span>
<span class="co">#&gt; $col</span>
<span class="co">#&gt; [1] "#animal"    "sire"       "dam"        "birth_date" "sex"       </span>
<span class="co">#&gt; [6] "plz"        "introg"     "inb_gen"    "cryo"      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dtp</span>
<span class="co">#&gt; [1] "integer"   "character" "integer"   "date"      "character" "integer"  </span>
<span class="co">#&gt; [7] "double"    "logical"   "logical"</span></pre></body></html></div>
<p>From this result, we can see that the column of “sire-IDs” has datatype character. This is not correct, because all ID-columns should have the same datatype. The problematic entry in the sire-ID column can be found by the result of the function <code><a href="../reference/check_pedigree_datatypes.html">check_pedigree_datatypes()</a></code>.</p>
<p>The check can now be run by</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">l_dtype</span> <span class="kw">&lt;-</span> <span class="no">l_ped_dt_result</span>$<span class="no">l_dtype</span>
<span class="no">l_dtype</span>$<span class="no">dtp</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">l_dtype</span>$<span class="no">col</span> <span class="kw">==</span> <span class="st">"sire"</span>)] <span class="kw">&lt;-</span> <span class="st">"integer"</span>
(<span class="no">l_dtp_check_result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/check_pedigree_datatypes.html">check_pedigree_datatypes</a></span>(<span class="kw">ps_pedig_path</span> <span class="kw">=</span> <span class="no">vec_ped_path</span>[<span class="fl">1</span>], <span class="kw">pl_dtype</span> <span class="kw">=</span> <span class="no">l_dtype</span>))
<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>

<span class="co">#&gt; Warning: `guess_max` is a very large value, setting to `21474836` to avoid</span>
<span class="co">#&gt; exhausting memory</span>
<span class="co">#&gt; Warning: 1 parsing failure.</span>
<span class="co">#&gt; row col   expected actual</span>
<span class="co">#&gt; 477  -- an integer      F</span>
<span class="co">#&gt; $PedFile</span>
<span class="co">#&gt; [1] "/private/var/folders/2v/jfsqj8zj2f122jcgy15nzfn00000gn/T/Rtmpn1cOGU/temp_libpath1769b2a27177a/qpdt/extdata/data_sample.csv"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ReqDType</span>
<span class="co">#&gt; $ReqDType$col</span>
<span class="co">#&gt; [1] "#animal"    "sire"       "dam"        "birth_date" "sex"       </span>
<span class="co">#&gt; [6] "plz"        "introg"     "inb_gen"    "cryo"      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ReqDType$dtp</span>
<span class="co">#&gt; [1] "integer"   "integer"   "integer"   "date"      "character" "integer"  </span>
<span class="co">#&gt; [7] "double"    "logical"   "logical"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CurDType</span>
<span class="co">#&gt; $CurDType$col</span>
<span class="co">#&gt; [1] "#animal"    "sire"       "dam"        "birth_date" "sex"       </span>
<span class="co">#&gt; [6] "plz"        "introg"     "inb_gen"    "cryo"      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CurDType$dtp</span>
<span class="co">#&gt; [1] "integer"   "character" "integer"   "date"      "character" "integer"  </span>
<span class="co">#&gt; [7] "double"    "logical"   "logical"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $DTypeProblems</span>
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   ped_col   row   col expected   actual</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; </span>
<span class="co">#&gt; 1 sire      477    NA an integer F</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
